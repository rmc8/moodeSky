name: Mobile - Compatibility Checks (Minimal)

on:
  push:
    branches: [ main ]
    paths:
      - 'moodeSky/**'
      - '.github/workflows/mobile.yml'
  pull_request:
    branches: [ main ]
    paths:
      - 'moodeSky/**'
  workflow_dispatch:  # æ‰‹å‹•å®Ÿè¡Œå¯èƒ½

env:
  CARGO_TERM_COLOR: always

jobs:
  # ãƒ¢ãƒã‚¤ãƒ«è¨­å®šãƒã‚§ãƒƒã‚¯ï¼ˆãƒ“ãƒ«ãƒ‰ãªã—ï¼‰
  mobile-preparation:
    name: Mobile Test Preparation
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: ./moodeSky

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Setup pnpm
        uses: pnpm/action-setup@v2
        with:
          version: latest

      - name: Setup Rust
        uses: dtolnay/rust-toolchain@stable

      - name: Install dependencies
        run: pnpm install

      - name: Check mobile configuration
        run: |
          # Tauri mobileè¨­å®šã®ç¢ºèªï¼ˆè»½é‡ï¼‰
          echo "ðŸ“± Checking mobile configuration..."
          
          # Androidè¨­å®šç¢ºèª
          if [ -d "src-tauri/gen/android" ]; then
            echo "âœ… Android configuration found"
          else
            echo "âš ï¸ Android configuration not found"
          fi
          
          # iOSè¨­å®šç¢ºèª
          if [ -d "src-tauri/gen/apple" ]; then
            echo "âœ… iOS configuration found"
          else
            echo "âš ï¸ iOS configuration not found"
          fi

      - name: Validate mobile dependencies
        run: |
          echo "ðŸ“¦ Checking mobile dependencies..."
          # package.jsonã®@tauri-apps/cliã‚’ç¢ºèª
          if pnpm list @tauri-apps/cli > /dev/null 2>&1; then
            echo "âœ… Tauri CLI installed"
          else
            echo "âš ï¸ Tauri CLI not found"
          fi

  # ãƒ¢ãƒã‚¤ãƒ«è¨­å®šã‚¬ã‚¤ãƒ‰ç”Ÿæˆ
  mobile-setup-guide:
    name: Generate Mobile Setup Guide
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Create mobile setup guide
        run: |
          cat > mobile-setup.md << 'EOF'
          # moodeSky Mobile Setup Guide
          
          ## Android Development
          
          1. Install Android Studio and Android SDK
          2. Setup Android targets:
             ```bash
             rustup target add aarch64-linux-android armv7-linux-androideabi
             ```
          3. Initialize Android project:
             ```bash
             cd moodeSky
             pnpm tauri android init
             ```
          4. Build Android app:
             ```bash
             pnpm tauri android build
             ```
          
          ## iOS Development (macOS required)
          
          1. Install Xcode
          2. Setup iOS targets:
             ```bash
             rustup target add aarch64-apple-ios x86_64-apple-ios
             ```
          3. Initialize iOS project:
             ```bash
             cd moodeSky
             pnpm tauri ios init
             ```
          4. Build iOS app:
             ```bash
             pnpm tauri ios build
             ```
          
          ## Notes
          - Mobile builds are currently disabled in CI to reduce complexity
          - Run mobile builds locally during development
          - Enable mobile CI when ready for production
          EOF
          
          echo "ðŸ“– Mobile setup guide generated"

      - name: Upload setup guide
        uses: actions/upload-artifact@v4
        with:
          name: mobile-setup-guide
          path: mobile-setup.md